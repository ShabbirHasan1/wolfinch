<!-- 
#  Copyright: (c) 2017-2021 Joshith Rayaroth Koderi
#  This file is part of Wolfinch screener.
# 
#  Wolfinch is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
# 
#  Wolfinch is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
# 
#  You should have received a copy of the GNU General Public License
#  along with Wolfinch.  If not, see <https://www.gnu.org/licenses/>. 
-->
<html lang="en">

<head>
<title>Wolfinch Trading Bot</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>

<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous"></script> -->

<link href="screener/stylesheet.css" rel="stylesheet">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
	integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
	crossorigin="anonymous"></script>


<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">

<script type="text/javascript" charset="utf8"
	src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>

<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script type="text/javascript">
	var table;
	$(document).ready(function() {

		console.log("load stats");
		load_screener_tables();
		setInterval(function() {
			console.log("refresh tables")
			load_screener_tables();
		}, 5000); //1200);		
	});

	function load_screener_tables() {
		console.log("loading exchanges and markets");
		// call api to buy/sell
		$.ajax({
			type : 'GET',
			url : "/api/screener/data",
			dataType : 'json',
			success : function(data) {
				console.log("get screener/data success!" + data);
				Object.keys(data).forEach(function(scrn_name) {
					console.log("load scrn_name: "+scrn_name);		
					load_tables (scrn_name, data[scrn_name]);
				});
			},
			error : function(xhr, error) {
				console.log("get screener/data failed!");
				alert(error);
			}
		});

	}	

	function load_tables(scrn_name, data) {

		console.log("load scrn_name "+scrn_name+" data : "+data);
		
/* 		if (table) {
			// previously init, just reload once and don't mess with timers
			table.ajax.reload(null, false); // user paging is not reset on reload
			return;
		} */

/* 	var dataSet = [
		 {"symbol": "aapl", "last_price": "10.2", "change": "10", "pct_change": "2"},
		 {"symbol": "codx", "last_price": "13.2", "change": "10", "pct_change": "2"}			
			 ] ; */
		 
		table = $('#statsTable').DataTable(
				{
					data : data,
					//ajax: '/api/data',
					"processing" : true,
					pageLength : 25,
/* 					ajax : {
						//url : "/api/screener/data",
 			 			data : dataSet,
						//dataSrc : dataSet
					}, */
					columns : [
							{
								title : "Symbol",
								data : "symbol"
							},
							{
								title : "Last price",
								data : "last_price"
							},
							{
								title : "Change",
								data : "change"
							},
							{
								title : "% change",
								data : "pct_change"
							}],

					"order" : [ [ 3, "desc" ] ],
					responsive : true
				});
	}
</script>


<body>
	<div class="row align-items-start">
		<div class="col-12">
			<div class="navbar navbar-inverse navbar-static-top">
				<div class="container">
					<header class="clearfix">
						<h3 class="brand">
							<a href="/">Wolfinch</a>
						</h3>
						<ul class="nav masthead-nav">
							<li class="active"><a href="#"> Home</a></li>
							<li><a href="wolfinch/chart.html">Charts </a></li>
							<li><a href="wolfinch/trading.html"> Trading</a></li>
							<li><a href="/"> Documentation</a></li>
						</ul>
					</header>
				</div>
			</div>
		</div>
	</div>
	<div>
		<p></p>
		<p></p>
	</div>

	<div class="container" style="padding-right: 1em;">
		<div class="row">
			<div class="table-responsive">
				<table style="margin: false; height: auto;" border="1">
					<tbody style="vertical-align: top">
						<tr style="background-color: rgba(0, 0, 0, 0.1);">
							<td align="center" style="font-size: 1vw; border: 0;"
													colspan="16"><b>Vol</b></td>
						</tr>
						<tr style="font-size: 1vw; width: auto; height: auto;"
							align="center">
							<td
								style="font-size: 1vw; width: 85%; height: auto; border-collapse: collapse;"
								colspan="1">
								<div class="table-responsive">
									<table id="statsTable" class="display compact"
										style="font-size: 1vw; vertical-align: top; height: 100%; width: auto">
										<thead>
											<tr>
												<th style="width: auto;">0</th>
												<th style="width: auto;">1</th>
												<th style="width: auto;">2</th>
												<th style="width: auto;">3</th>
											</tr>
										</thead>
										<tbody></tbody>
									</table>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<footer class="footer">
		<div class="container">
			<p>
				<small>
					<div class="row">
						<em>&copy; 2017-2021 Wolfinch Screener</em>
					</div>
				</small>
			</p>
		</div>
	</footer>
</body>
</html>
